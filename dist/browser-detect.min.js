!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():e.browser=r()}(this,function(){"use strict";function e(e){if(void 0===e){if("undefined"!=typeof process){var r=process.version.slice(1).split(".").slice(0,3),n=Array.prototype.slice.call(r,1).join("")||"0";return{name:"node",version:r.join("."),versionNumber:parseFloat(r[0]+"."+n)}}throw"Please give user-agent.\n> browser(navigator.userAgent or res.headers['user-agent'])."}return[["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+)\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/]].filter(function(r){return r[1].test(e)}).map(function(r){var n=r[1].exec(e),o=n&&n[1].split(/[._]/).slice(0,3),t=Array.prototype.slice.call(o,1).join("")||"0";return o&&o.length<3&&Array.prototype.push.apply(o,1===o.length?[0,0]:[0]),{name:r[0],version:o.join("."),versionNumber:parseFloat(o[0]+"."+t)}}).shift()}var r,n,o,t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return function(e){function i(e,r){return j.call(e,r)}function f(e,r){var n,o,t,i,f,u,s,l,c,p,a,d,y=r&&r.split("/"),m=w.map,h=m&&m["*"]||{};if(e){for(e=e.split("/"),f=e.length-1,w.nodeIdCompat&&S.test(e[f])&&(e[f]=e[f].replace(S,"")),"."===e[0].charAt(0)&&y&&(d=y.slice(0,y.length-1),e=d.concat(e)),c=0;c<e.length;c++)if("."===(a=e[c]))e.splice(c,1),c-=1;else if(".."===a){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((y||h)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(o=n.slice(0,c).join("/"),y)for(p=y.length;p>0;p-=1)if((t=m[y.slice(0,p).join("/")])&&(t=t[o])){i=t,u=c;break}if(i)break;!s&&h&&h[o]&&(s=h[o],l=c)}!i&&s&&(i=s,u=l),i&&(n.splice(0,u,i),e=n.join("/"))}return e}function u(r,n){return function(){var o=A.call(arguments,0);return"string"!=typeof o[0]&&1===o.length&&o.push(null),m.apply(e,o.concat([r,n]))}}function s(e){return function(r){return f(r,e)}}function l(e){return function(r){v[e]=r}}function c(r){if(i(b,r)){var n=b[r];delete b[r],x[r]=!0,y.apply(e,n)}if(!i(v,r)&&!i(x,r))throw new Error("No "+r);return v[r]}function p(e){var r,n=e?e.indexOf("!"):-1;return n>-1&&(r=e.substring(0,n),e=e.substring(n+1,e.length)),[r,e]}function a(e){return e?p(e):[]}function d(e){return function(){return w&&w.config&&w.config[e]||{}}}var y,m,h,g,v={},b={},w={},x={},j=Object.prototype.hasOwnProperty,A=[].slice,S=/\.js$/;h=function(e,r){var n,o=p(e),t=o[0],i=r[1];return e=o[1],t&&(t=f(t,i),n=c(t)),t?e=n&&n.normalize?n.normalize(e,s(i)):f(e,i):(e=f(e,i),o=p(e),t=o[0],e=o[1],t&&(n=c(t))),{f:t?t+"!"+e:e,n:e,pr:t,p:n}},g={require:function(e){return u(e)},exports:function(e){var r=v[e];return void 0!==r?r:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},y=function(r,n,o,f){var s,p,d,y,m,w,j,A=[],S=void 0===o?"undefined":t(o);if(f=f||r,w=a(f),"undefined"===S||"function"===S){for(n=!n.length&&o.length?["require","exports","module"]:n,m=0;m<n.length;m+=1)if(y=h(n[m],w),"require"===(p=y.f))A[m]=g.require(r);else if("exports"===p)A[m]=g.exports(r),j=!0;else if("module"===p)s=A[m]=g.module(r);else if(i(v,p)||i(b,p)||i(x,p))A[m]=c(p);else{if(!y.p)throw new Error(r+" missing "+p);y.p.load(y.n,u(f,!0),l(p),{}),A[m]=v[p]}d=o?o.apply(v[r],A):void 0,r&&(s&&s.exports!==e&&s.exports!==v[r]?v[r]=s.exports:d===e&&j||(v[r]=d))}else r&&(v[r]=o)},r=n=m=function(r,n,o,t,i){if("string"==typeof r)return g[r]?g[r](n):c(h(r,a(n)).f);if(!r.splice){if(w=r,w.deps&&m(w.deps,w.callback),!n)return;n.splice?(r=n,n=o,o=null):r=e}return n=n||function(){},"function"==typeof o&&(o=t,t=i),t?y(e,r,n,o):setTimeout(function(){y(e,r,n,o)},4),m},m.config=function(e){return m(e)},r._defined=v,o=function(e,r,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");r.splice||(n=r,r=[]),i(v,e)||i(b,e)||(b[e]=[e,r,n])},o.amd={jQuery:!0}}(),o("almond",function(){}),void 0===Array.prototype.map&&(Array.prototype.map=function(e){for(var r=[],n=0,o=this.length;n<o;n++)r.push(e(this[n]));return r}),void 0===Array.prototype.filter&&(Array.prototype.filter=function(e){for(var r=[],n=0,o=this.length;n<o;n++)e(this[n])&&r.push(this[n]);return r}),o("polyfills",function(){}),o("browser-detect",["polyfills"],function(){return e}),o("main",["browser-detect"],function(e){return function(r){var n;if(void 0===r){var o="undefined"!=typeof window?window.navigator:o;n=void 0===o?void 0:o.userAgent}else n=r;return e(n)}}),n("main")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbW9uZC5qcyIsImJyb3dzZXItZGV0ZWN0LmpzIiwibWFpbi5qcyIsInBvbHlmaWxscy5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiZmFjdG9yeSIsInRoaXMiLCJ2ZXJzaW9uTnVtYmVyIiwidXNlckFnZW50IiwicHJvY2VzcyIsInZlcnNpb24iLCJzbGljZSIsInNwbGl0IiwidmVyc2lvblRhaWxzIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjYWxsIiwiam9pbiIsIm5hbWUiLCJicm93c2VycyIsImZpbHRlciIsImVsZW1lbnQiLCJtYXAiLCJleGVjIiwicGFyc2VGbG9hdCIsImxhc3RJbmRleCIsImxlbmd0aCIsInB1c2giLCJhcHBseSIsImJyb3dzZXJEZXRlY3QiLCJzaGlmdCIsInJlcXVpcmVqcyIsImRlZmluaW5nIiwiZGVmaW5lIiwiaGFzT3duIiwibm9ybWFsaXplIiwiYmFzZU5hbWUiLCJqIiwicGFydCIsIm5vcm1hbGl6ZWRCYXNlUGFydHMiLCJiYXNlUGFydHMiLCJzdGFyTWFwIiwic3RhckkiLCJjb25maWciLCJub2RlSWRDb21wYXQiLCJqc1N1ZmZpeFJlZ0V4cCIsInRlc3QiLCJyZXBsYWNlIiwiaSIsImNvbmNhdCIsInNwbGljZSIsIm1hcFZhbHVlIiwibmFtZVBhcnRzIiwibmFtZVNlZ21lbnQiLCJmb3VuZE1hcCIsImZvdW5kSSIsImZvdW5kU3Rhck1hcCIsIm1ha2VSZXF1aXJlIiwicmVsTmFtZSIsImZvcmNlU3luYyIsImFyZ3MiLCJhcHMiLCJhcmd1bWVudHMiLCJtYWtlTm9ybWFsaXplIiwibWFrZUxvYWQiLCJ3YWl0aW5nIiwidmFsdWUiLCJtYWluIiwiY2FsbERlcCIsImhhc1Byb3AiLCJkZWZpbmVkIiwidW5kZWYiLCJzcGxpdFByZWZpeCIsInByZWZpeCIsIkVycm9yIiwiaW5kZXgiLCJpbmRleE9mIiwibWFrZVJlbFBhcnRzIiwic3Vic3RyaW5nIiwibWFrZU1hcCIsInBsdWdpbiIsIm1ha2VDb25maWciLCJlIiwiaGFuZGxlcnMiLCJwYXJ0cyIsInJlbFJlc291cmNlTmFtZSIsInJlbFBhcnRzIiwiZiIsIm4iLCJwciIsInJlcXVpcmUiLCJpZCIsInVyaSIsImNqc01vZHVsZSIsImRlcE5hbWUiLCJ1c2luZ0V4cG9ydHMiLCJkZXBzIiwiY2FsbGJhY2siLCJjYWxsYmFja1R5cGUiLCJfdHlwZW9mIiwicCIsImxvYWQiLCJyZXQiLCJ1bmRlZmluZWQiLCJfcmVxdWlyZSIsInJlcSIsImFsdCIsInNldFRpbWVvdXQiLCJjZmciLCJfZGVmaW5lZCIsImFtZCIsImpRdWVyeSIsInJ2IiwiZm4iLCJsIiwibmF2aWdhdG9yIiwiX3VzZXJBZ2VudCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IjJGQUFBQSxPQUFBQyxRQUFBQyxtQkFJQUMsS0FBQSxXQUNBLFlBQUFDLFNBQUFBLEdBQUFBLEdDQ0EsT0FBQSxLQUFBQyxFQUFBLENBS0EsR0RIQSxtQkFBQUMsU0FBQSxDQUNBLEdBQUFDLEdBQUFELFFBQUFDLFFBQUFDLE1BQ0EsR0FBQUMsTUFBQSxLQUFBRCxNQUFBLEVBQUEsR0FBQUUsRUFBQUMsTUFBQUMsVUFBQUosTUFBQUssS0FBQU4sRUFBQSxHQUFBTyxLQUFBLEtBQUEsV0FBQUMsS0FBQSxPQUFBQyxRQUFBVCxFQUFBTyxLQUFBLDJDQXNCQSxLQUFBLHdGQUFBLFFBQUFQLE9BQUFBLHNCQUFBLGdCQUFBLDJCQUFBLFNBQUEscURBQUEsUUFBQSw4QkFBQSxVQUFBLGdDQUFBLFFBQUEsOEJBQUEsUUFBQSw2QkFBQSxLQUFBLDRDQUFBLEtBQUEsd0NBQUEsS0FBQSxpQkFBQSxPQUFBLHNDQUFBLFVBQUEsd0JBQUEsTUFBQSwyQ0FBQSxTQUFBLGlDQUFBVSxPQUFBLFNBQUFDLHlCQUFBQyxJQUFBLFNBQUFELEdBQUFILEdBQUFBLEdBQUFHLEVBQUEsR0FBQUUsS0FBQWYsR0FBQUUsRUFBQUEsR0FBQU8sRUFBQSxHQUFBTCxNQUFBLFFBQUFELE1BQUEsRUFBQSxHQUFBSixFQUFBaUIsTUFBQUEsVUFBQWQsTUFBQU0s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LE9FM0NBLEtBQUEyRyxNRjJDQVoiLCJmaWxlIjoiYnJvd3Nlci1kZXRlY3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlIGFsbW9uZCAwLjMuMyBDb3B5cmlnaHQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycy5cbiAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlLCBodHRwOi8vZ2l0aHViLmNvbS9yZXF1aXJlanMvYWxtb25kL0xJQ0VOU0VcbiAqL1xuLy9Hb2luZyBzbG9wcHkgdG8gYXZvaWQgJ3VzZSBzdHJpY3QnIHN0cmluZyBjb3N0LCBidXQgc3RyaWN0IHByYWN0aWNlcyBzaG91bGRcbi8vYmUgZm9sbG93ZWQuXG4vKmdsb2JhbCBzZXRUaW1lb3V0OiBmYWxzZSAqL1xuXG52YXIgcmVxdWlyZWpzLCByZXF1aXJlLCBkZWZpbmU7XG4oZnVuY3Rpb24gKHVuZGVmKSB7XG4gICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsXG4gICAgICAgIGRlZmluZWQgPSB7fSxcbiAgICAgICAgd2FpdGluZyA9IHt9LFxuICAgICAgICBjb25maWcgPSB7fSxcbiAgICAgICAgZGVmaW5pbmcgPSB7fSxcbiAgICAgICAgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgICAgYXBzID0gW10uc2xpY2UsXG4gICAgICAgIGpzU3VmZml4UmVnRXhwID0gL1xcLmpzJC87XG5cbiAgICBmdW5jdGlvbiBoYXNQcm9wKG9iaiwgcHJvcCkge1xuICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwob2JqLCBwcm9wKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhIHJlbGF0aXZlIG1vZHVsZSBuYW1lLCBsaWtlIC4vc29tZXRoaW5nLCBub3JtYWxpemUgaXQgdG9cbiAgICAgKiBhIHJlYWwgbmFtZSB0aGF0IGNhbiBiZSBtYXBwZWQgdG8gYSBwYXRoLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZWxhdGl2ZSBuYW1lXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGJhc2VOYW1lIGEgcmVhbCBuYW1lIHRoYXQgdGhlIG5hbWUgYXJnIGlzIHJlbGF0aXZlXG4gICAgICogdG8uXG4gICAgICogQHJldHVybnMge1N0cmluZ30gbm9ybWFsaXplZCBuYW1lXG4gICAgICovXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplKG5hbWUsIGJhc2VOYW1lKSB7XG4gICAgICAgIHZhciBuYW1lUGFydHMsIG5hbWVTZWdtZW50LCBtYXBWYWx1ZSwgZm91bmRNYXAsIGxhc3RJbmRleCxcbiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwgbm9ybWFsaXplZEJhc2VQYXJ0cyxcbiAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VOYW1lICYmIGJhc2VOYW1lLnNwbGl0KFwiL1wiKSxcbiAgICAgICAgICAgIG1hcCA9IGNvbmZpZy5tYXAsXG4gICAgICAgICAgICBzdGFyTWFwID0gKG1hcCAmJiBtYXBbJyonXSkgfHwge307XG5cbiAgICAgICAgLy9BZGp1c3QgYW55IHJlbGF0aXZlIHBhdGhzLlxuICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJy8nKTtcbiAgICAgICAgICAgIGxhc3RJbmRleCA9IG5hbWUubGVuZ3RoIC0gMTtcblxuICAgICAgICAgICAgLy8gSWYgd2FudGluZyBub2RlIElEIGNvbXBhdGliaWxpdHksIHN0cmlwIC5qcyBmcm9tIGVuZFxuICAgICAgICAgICAgLy8gb2YgSURzLiBIYXZlIHRvIGRvIHRoaXMgaGVyZSwgYW5kIG5vdCBpbiBuYW1lVG9VcmxcbiAgICAgICAgICAgIC8vIGJlY2F1c2Ugbm9kZSBhbGxvd3MgZWl0aGVyIC5qcyBvciBub24gLmpzIHRvIG1hcFxuICAgICAgICAgICAgLy8gdG8gc2FtZSBmaWxlLlxuICAgICAgICAgICAgaWYgKGNvbmZpZy5ub2RlSWRDb21wYXQgJiYganNTdWZmaXhSZWdFeHAudGVzdChuYW1lW2xhc3RJbmRleF0pKSB7XG4gICAgICAgICAgICAgICAgbmFtZVtsYXN0SW5kZXhdID0gbmFtZVtsYXN0SW5kZXhdLnJlcGxhY2UoanNTdWZmaXhSZWdFeHAsICcnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3RhcnRzIHdpdGggYSAnLicgc28gbmVlZCB0aGUgYmFzZU5hbWVcbiAgICAgICAgICAgIGlmIChuYW1lWzBdLmNoYXJBdCgwKSA9PT0gJy4nICYmIGJhc2VQYXJ0cykge1xuICAgICAgICAgICAgICAgIC8vQ29udmVydCBiYXNlTmFtZSB0byBhcnJheSwgYW5kIGxvcCBvZmYgdGhlIGxhc3QgcGFydCxcbiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgJ2RpcmVjdG9yeScgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzXG4gICAgICAgICAgICAgICAgLy9tb2R1bGUuIEZvciBpbnN0YW5jZSwgYmFzZU5hbWUgb2YgJ29uZS90d28vdGhyZWUnLCBtYXBzIHRvXG4gICAgICAgICAgICAgICAgLy8nb25lL3R3by90aHJlZS5qcycsIGJ1dCB3ZSB3YW50IHRoZSBkaXJlY3RvcnksICdvbmUvdHdvJyBmb3JcbiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi5cbiAgICAgICAgICAgICAgICBub3JtYWxpemVkQmFzZVBhcnRzID0gYmFzZVBhcnRzLnNsaWNlKDAsIGJhc2VQYXJ0cy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplZEJhc2VQYXJ0cy5jb25jYXQobmFtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vc3RhcnQgdHJpbURvdHNcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuYW1lLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcGFydCA9IG5hbWVbaV07XG4gICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09ICcuJykge1xuICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgaSAtPSAxO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydCA9PT0gJy4uJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBhdCB0aGUgc3RhcnQsIG9yIHByZXZpb3VzIHZhbHVlIGlzIHN0aWxsIC4uLFxuICAgICAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZW0gc28gdGhhdCB3aGVuIGNvbnZlcnRlZCB0byBhIHBhdGggaXQgbWF5XG4gICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIHdvcmsgd2hlbiBjb252ZXJ0ZWQgdG8gYSBwYXRoLCBldmVuIHRob3VnaFxuICAgICAgICAgICAgICAgICAgICAvLyBhcyBhbiBJRCBpdCBpcyBsZXNzIHRoYW4gaWRlYWwuIEluIGxhcmdlciBwb2ludFxuICAgICAgICAgICAgICAgICAgICAvLyByZWxlYXNlcywgbWF5IGJlIGJldHRlciB0byBqdXN0IGtpY2sgb3V0IGFuIGVycm9yLlxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCB8fCAoaSA9PT0gMSAmJiBuYW1lWzJdID09PSAnLi4nKSB8fCBuYW1lW2kgLSAxXSA9PT0gJy4uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGkgLSAxLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vZW5kIHRyaW1Eb3RzXG5cbiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmpvaW4oJy8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQXBwbHkgbWFwIGNvbmZpZyBpZiBhdmFpbGFibGUuXG4gICAgICAgIGlmICgoYmFzZVBhcnRzIHx8IHN0YXJNYXApICYmIG1hcCkge1xuICAgICAgICAgICAgbmFtZVBhcnRzID0gbmFtZS5zcGxpdCgnLycpO1xuXG4gICAgICAgICAgICBmb3IgKGkgPSBuYW1lUGFydHMubGVuZ3RoOyBpID4gMDsgaSAtPSAxKSB7XG4gICAgICAgICAgICAgICAgbmFtZVNlZ21lbnQgPSBuYW1lUGFydHMuc2xpY2UoMCwgaSkuam9pbihcIi9cIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoYmFzZVBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vRmluZCB0aGUgbG9uZ2VzdCBiYXNlTmFtZSBzZWdtZW50IG1hdGNoIGluIHRoZSBjb25maWcuXG4gICAgICAgICAgICAgICAgICAgIC8vU28sIGRvIGpvaW5zIG9uIHRoZSBiaWdnZXN0IHRvIHNtYWxsZXN0IGxlbmd0aHMgb2YgYmFzZVBhcnRzLlxuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiYXNlUGFydHMubGVuZ3RoOyBqID4gMDsgaiAtPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBWYWx1ZSA9IG1hcFtiYXNlUGFydHMuc2xpY2UoMCwgaikuam9pbignLycpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9iYXNlTmFtZSBzZWdtZW50IGhhcyAgY29uZmlnLCBmaW5kIGlmIGl0IGhhcyBvbmUgZm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMgbmFtZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwVmFsdWVbbmFtZVNlZ21lbnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01hdGNoLCB1cGRhdGUgbmFtZSB0byB0aGUgbmV3IHZhbHVlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IG1hcFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZEkgPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZm91bmRNYXApIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgYSBzdGFyIG1hcCBtYXRjaCwgYnV0IGp1c3QgaG9sZCBvbiB0byBpdCxcbiAgICAgICAgICAgICAgICAvL2lmIHRoZXJlIGlzIGEgc2hvcnRlciBzZWdtZW50IG1hdGNoIGxhdGVyIGluIGEgbWF0Y2hpbmdcbiAgICAgICAgICAgICAgICAvL2NvbmZpZywgdGhlbiBmYXZvciBvdmVyIHRoaXMgc3RhciBtYXAuXG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJNYXAgJiYgc3Rhck1hcCAmJiBzdGFyTWFwW25hbWVTZWdtZW50XSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJNYXAgPSBzdGFyTWFwW25hbWVTZWdtZW50XTtcbiAgICAgICAgICAgICAgICAgICAgc3RhckkgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFmb3VuZE1hcCAmJiBmb3VuZFN0YXJNYXApIHtcbiAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IGZvdW5kU3Rhck1hcDtcbiAgICAgICAgICAgICAgICBmb3VuZEkgPSBzdGFySTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7XG4gICAgICAgICAgICAgICAgbmFtZVBhcnRzLnNwbGljZSgwLCBmb3VuZEksIGZvdW5kTWFwKTtcbiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZVBhcnRzLmpvaW4oJy8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VSZXF1aXJlKHJlbE5hbWUsIGZvcmNlU3luYykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy9BIHZlcnNpb24gb2YgYSByZXF1aXJlIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIGEgbW9kdWxlTmFtZVxuICAgICAgICAgICAgLy92YWx1ZSBmb3IgaXRlbXMgdGhhdCBtYXkgbmVlZCB0b1xuICAgICAgICAgICAgLy9sb29rIHVwIHBhdGhzIHJlbGF0aXZlIHRvIHRoZSBtb2R1bGVOYW1lXG4gICAgICAgICAgICB2YXIgYXJncyA9IGFwcy5jYWxsKGFyZ3VtZW50cywgMCk7XG5cbiAgICAgICAgICAgIC8vSWYgZmlyc3QgYXJnIGlzIG5vdCByZXF1aXJlKCdzdHJpbmcnKSwgYW5kIHRoZXJlIGlzIG9ubHlcbiAgICAgICAgICAgIC8vb25lIGFyZywgaXQgaXMgdGhlIGFycmF5IGZvcm0gd2l0aG91dCBhIGNhbGxiYWNrLiBJbnNlcnRcbiAgICAgICAgICAgIC8vYSBudWxsIHNvIHRoYXQgdGhlIGZvbGxvd2luZyBjb25jYXQgaXMgY29ycmVjdC5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnc1swXSAhPT0gJ3N0cmluZycgJiYgYXJncy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBhcmdzLnB1c2gobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVxLmFwcGx5KHVuZGVmLCBhcmdzLmNvbmNhdChbcmVsTmFtZSwgZm9yY2VTeW5jXSkpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VOb3JtYWxpemUocmVsTmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBub3JtYWxpemUobmFtZSwgcmVsTmFtZSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZUxvYWQoZGVwTmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBkZWZpbmVkW2RlcE5hbWVdID0gdmFsdWU7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FsbERlcChuYW1lKSB7XG4gICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IHdhaXRpbmdbbmFtZV07XG4gICAgICAgICAgICBkZWxldGUgd2FpdGluZ1tuYW1lXTtcbiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgIG1haW4uYXBwbHkodW5kZWYsIGFyZ3MpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFoYXNQcm9wKGRlZmluZWQsIG5hbWUpICYmICFoYXNQcm9wKGRlZmluaW5nLCBuYW1lKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyAnICsgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmluZWRbbmFtZV07XG4gICAgfVxuXG4gICAgLy9UdXJucyBhIHBsdWdpbiFyZXNvdXJjZSB0byBbcGx1Z2luLCByZXNvdXJjZV1cbiAgICAvL3dpdGggdGhlIHBsdWdpbiBiZWluZyB1bmRlZmluZWQgaWYgdGhlIG5hbWVcbiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguXG4gICAgZnVuY3Rpb24gc3BsaXRQcmVmaXgobmFtZSkge1xuICAgICAgICB2YXIgcHJlZml4LFxuICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHByZWZpeCA9IG5hbWUuc3Vic3RyaW5nKDAsIGluZGV4KTtcbiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW3ByZWZpeCwgbmFtZV07XG4gICAgfVxuXG4gICAgLy9DcmVhdGVzIGEgcGFydHMgYXJyYXkgZm9yIGEgcmVsTmFtZSB3aGVyZSBmaXJzdCBwYXJ0IGlzIHBsdWdpbiBJRCxcbiAgICAvL3NlY29uZCBwYXJ0IGlzIHJlc291cmNlIElELiBBc3N1bWVzIHJlbE5hbWUgaGFzIGFscmVhZHkgYmVlbiBub3JtYWxpemVkLlxuICAgIGZ1bmN0aW9uIG1ha2VSZWxQYXJ0cyhyZWxOYW1lKSB7XG4gICAgICAgIHJldHVybiByZWxOYW1lID8gc3BsaXRQcmVmaXgocmVsTmFtZSkgOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWtlcyBhIG5hbWUgbWFwLCBub3JtYWxpemluZyB0aGUgbmFtZSwgYW5kIHVzaW5nIGEgcGx1Z2luXG4gICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW5cbiAgICAgKiB0b28sIGFzIGFuIG9wdGltaXphdGlvbi5cbiAgICAgKi9cbiAgICBtYWtlTWFwID0gZnVuY3Rpb24gKG5hbWUsIHJlbFBhcnRzKSB7XG4gICAgICAgIHZhciBwbHVnaW4sXG4gICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLFxuICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF0sXG4gICAgICAgICAgICByZWxSZXNvdXJjZU5hbWUgPSByZWxQYXJ0c1sxXTtcblxuICAgICAgICBuYW1lID0gcGFydHNbMV07XG5cbiAgICAgICAgaWYgKHByZWZpeCkge1xuICAgICAgICAgICAgcHJlZml4ID0gbm9ybWFsaXplKHByZWZpeCwgcmVsUmVzb3VyY2VOYW1lKTtcbiAgICAgICAgICAgIHBsdWdpbiA9IGNhbGxEZXAocHJlZml4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vTm9ybWFsaXplIGFjY29yZGluZ1xuICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgICBpZiAocGx1Z2luICYmIHBsdWdpbi5ub3JtYWxpemUpIHtcbiAgICAgICAgICAgICAgICBuYW1lID0gcGx1Z2luLm5vcm1hbGl6ZShuYW1lLCBtYWtlTm9ybWFsaXplKHJlbFJlc291cmNlTmFtZSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbFJlc291cmNlTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbFJlc291cmNlTmFtZSk7XG4gICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpO1xuICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07XG4gICAgICAgICAgICBuYW1lID0gcGFydHNbMV07XG4gICAgICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9Vc2luZyByaWRpY3Vsb3VzIHByb3BlcnR5IG5hbWVzIGZvciBzcGFjZSByZWFzb25zXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZVxuICAgICAgICAgICAgbjogbmFtZSxcbiAgICAgICAgICAgIHByOiBwcmVmaXgsXG4gICAgICAgICAgICBwOiBwbHVnaW5cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gbWFrZUNvbmZpZyhuYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGhhbmRsZXJzID0ge1xuICAgICAgICByZXF1aXJlOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpO1xuICAgICAgICB9LFxuICAgICAgICBleHBvcnRzOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGRlZmluZWRbbmFtZV0gPSB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG1vZHVsZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IG5hbWUsXG4gICAgICAgICAgICAgICAgdXJpOiAnJyxcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBkZWZpbmVkW25hbWVdLFxuICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBtYWluID0gZnVuY3Rpb24gKG5hbWUsIGRlcHMsIGNhbGxiYWNrLCByZWxOYW1lKSB7XG4gICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLCByZWxQYXJ0cyxcbiAgICAgICAgICAgIGFyZ3MgPSBbXSxcbiAgICAgICAgICAgIGNhbGxiYWNrVHlwZSA9IHR5cGVvZiBjYWxsYmFjayxcbiAgICAgICAgICAgIHVzaW5nRXhwb3J0cztcblxuICAgICAgICAvL1VzZSBuYW1lIGlmIG5vIHJlbE5hbWVcbiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTtcbiAgICAgICAgcmVsUGFydHMgPSBtYWtlUmVsUGFydHMocmVsTmFtZSk7XG5cbiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LlxuICAgICAgICBpZiAoY2FsbGJhY2tUeXBlID09PSAndW5kZWZpbmVkJyB8fCBjYWxsYmFja1R5cGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkXG4gICAgICAgICAgICAvL3ZhbHVlcyB0byB0aGUgY2FsbGJhY2suXG4gICAgICAgICAgICAvL0RlZmF1bHQgdG8gW3JlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZV0gaWYgbm8gZGVwc1xuICAgICAgICAgICAgZGVwcyA9ICFkZXBzLmxlbmd0aCAmJiBjYWxsYmFjay5sZW5ndGggPyBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSA6IGRlcHM7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIG1hcCA9IG1ha2VNYXAoZGVwc1tpXSwgcmVsUGFydHMpO1xuICAgICAgICAgICAgICAgIGRlcE5hbWUgPSBtYXAuZjtcblxuICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy5cbiAgICAgICAgICAgICAgICBpZiAoZGVwTmFtZSA9PT0gXCJyZXF1aXJlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGhhbmRsZXJzLnJlcXVpcmUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSBcImV4cG9ydHNcIikge1xuICAgICAgICAgICAgICAgICAgICAvL0NvbW1vbkpTIG1vZHVsZSBzcGVjIDEuMVxuICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMuZXhwb3J0cyhuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgdXNpbmdFeHBvcnRzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcE5hbWUgPT09IFwibW9kdWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjFcbiAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlID0gYXJnc1tpXSA9IGhhbmRsZXJzLm1vZHVsZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc1Byb3AoZGVmaW5lZCwgZGVwTmFtZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3Aod2FpdGluZywgZGVwTmFtZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3AoZGVmaW5pbmcsIGRlcE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBjYWxsRGVwKGRlcE5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFwLnApIHtcbiAgICAgICAgICAgICAgICAgICAgbWFwLnAubG9hZChtYXAubiwgbWFrZVJlcXVpcmUocmVsTmFtZSwgdHJ1ZSksIG1ha2VMb2FkKGRlcE5hbWUpLCB7fSk7XG4gICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBkZWZpbmVkW2RlcE5hbWVdO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldCA9IGNhbGxiYWNrID8gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncykgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhIFwibW9kdWxlXCIgaXMgaW4gcGxheSxcbiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsXG4gICAgICAgICAgICAgICAgLy9mYXZvciBhIG5vbi11bmRlZmluZWQgcmV0dXJuIHZhbHVlIG92ZXIgZXhwb3J0cyB1c2UuXG4gICAgICAgICAgICAgICAgaWYgKGNqc01vZHVsZSAmJiBjanNNb2R1bGUuZXhwb3J0cyAhPT0gdW5kZWYgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjanNNb2R1bGUuZXhwb3J0cztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJldCAhPT0gdW5kZWYgfHwgIXVzaW5nRXhwb3J0cykge1xuICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLlxuICAgICAgICAgICAgICAgICAgICBkZWZpbmVkW25hbWVdID0gcmV0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAvL01heSBqdXN0IGJlIGFuIG9iamVjdCBkZWZpbml0aW9uIGZvciB0aGUgbW9kdWxlLiBPbmx5XG4gICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS5cbiAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjYWxsYmFjaztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICByZXF1aXJlanMgPSByZXF1aXJlID0gcmVxID0gZnVuY3Rpb24gKGRlcHMsIGNhbGxiYWNrLCByZWxOYW1lLCBmb3JjZVN5bmMsIGFsdCkge1xuICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkge1xuICAgICAgICAgICAgICAgIC8vY2FsbGJhY2sgaW4gdGhpcyBjYXNlIGlzIHJlYWxseSByZWxOYW1lXG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXJzW2RlcHNdKGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vSnVzdCByZXR1cm4gdGhlIG1vZHVsZSB3YW50ZWQuIEluIHRoaXMgc2NlbmFyaW8sIHRoZVxuICAgICAgICAgICAgLy9kZXBzIGFyZyBpcyB0aGUgbW9kdWxlIG5hbWUsIGFuZCBzZWNvbmQgYXJnIChpZiBwYXNzZWQpXG4gICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuXG4gICAgICAgICAgICAvL05vcm1hbGl6ZSBtb2R1bGUgbmFtZSwgaWYgaXQgY29udGFpbnMgLiBvciAuLlxuICAgICAgICAgICAgcmV0dXJuIGNhbGxEZXAobWFrZU1hcChkZXBzLCBtYWtlUmVsUGFydHMoY2FsbGJhY2spKS5mKTtcbiAgICAgICAgfSBlbHNlIGlmICghZGVwcy5zcGxpY2UpIHtcbiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS5cbiAgICAgICAgICAgIGNvbmZpZyA9IGRlcHM7XG4gICAgICAgICAgICBpZiAoY29uZmlnLmRlcHMpIHtcbiAgICAgICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2suc3BsaWNlKSB7XG4gICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuXG4gICAgICAgICAgICAgICAgLy9BZGp1c3QgYXJncyBpZiB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICAgICAgZGVwcyA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTtcbiAgICAgICAgICAgICAgICByZWxOYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9TdXBwb3J0IHJlcXVpcmUoWydhJ10pXG4gICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307XG5cbiAgICAgICAgLy9JZiByZWxOYW1lIGlzIGEgZnVuY3Rpb24sIGl0IGlzIGFuIGVycmJhY2sgaGFuZGxlcixcbiAgICAgICAgLy9zbyByZW1vdmUgaXQuXG4gICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmVsTmFtZSA9IGZvcmNlU3luYztcbiAgICAgICAgICAgIGZvcmNlU3luYyA9IGFsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vU2ltdWxhdGUgYXN5bmMgY2FsbGJhY2s7XG4gICAgICAgIGlmIChmb3JjZVN5bmMpIHtcbiAgICAgICAgICAgIG1haW4odW5kZWYsIGRlcHMsIGNhbGxiYWNrLCByZWxOYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzXG4gICAgICAgICAgICAvL2RvLCBhbmQgbGF0ZXN0IGJyb3dzZXJzIFwidXBncmFkZVwiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDpcbiAgICAgICAgICAgIC8vaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvdGltZXJzLmh0bWwjZG9tLXdpbmRvd3RpbWVycy1zZXR0aW1lb3V0OlxuICAgICAgICAgICAgLy9JZiB3YW50IGEgdmFsdWUgaW1tZWRpYXRlbHksIHVzZSByZXF1aXJlKCdpZCcpIGluc3RlYWQgLS0gc29tZXRoaW5nXG4gICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmRcbiAgICAgICAgICAgIC8vdW5saWtlbHkgdG8gd29yayBpbiBvdGhlciBBTUQgaW1wbGVtZW50YXRpb25zLlxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpO1xuICAgICAgICAgICAgfSwgNCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVxO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBKdXN0IGRyb3BzIHRoZSBjb25maWcgb24gdGhlIGZsb29yLCBidXQgcmV0dXJucyByZXEgaW4gY2FzZVxuICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuXG4gICAgICovXG4gICAgcmVxLmNvbmZpZyA9IGZ1bmN0aW9uIChjZmcpIHtcbiAgICAgICAgcmV0dXJuIHJlcShjZmcpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBFeHBvc2UgbW9kdWxlIHJlZ2lzdHJ5IGZvciBkZWJ1Z2dpbmcgYW5kIHRvb2xpbmdcbiAgICAgKi9cbiAgICByZXF1aXJlanMuX2RlZmluZWQgPSBkZWZpbmVkO1xuXG4gICAgZGVmaW5lID0gZnVuY3Rpb24gKG5hbWUsIGRlcHMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VlIGFsbW9uZCBSRUFETUU6IGluY29ycmVjdCBtb2R1bGUgYnVpbGQsIG5vIG1vZHVsZSBuYW1lJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXNcbiAgICAgICAgaWYgKCFkZXBzLnNwbGljZSkge1xuICAgICAgICAgICAgLy9kZXBzIGlzIG5vdCBhbiBhcnJheSwgc28gcHJvYmFibHkgbWVhbnNcbiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3JcbiAgICAgICAgICAgIC8vdGhlIHZhbHVlLiBBZGp1c3QgYXJncy5cbiAgICAgICAgICAgIGNhbGxiYWNrID0gZGVwcztcbiAgICAgICAgICAgIGRlcHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkge1xuICAgICAgICAgICAgd2FpdGluZ1tuYW1lXSA9IFtuYW1lLCBkZXBzLCBjYWxsYmFja107XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgZGVmaW5lLmFtZCA9IHtcbiAgICAgICAgalF1ZXJ5OiB0cnVlXG4gICAgfTtcbn0oKSk7XG5cbmRlZmluZShcImFsbW9uZFwiLCBmdW5jdGlvbigpe30pO1xuXG4iLCJmdW5jdGlvbiBicm93c2VyRGV0ZWN0b3IodXNlckFnZW50KSB7XHJcbiAgICBpZiAodHlwZW9mIHVzZXJBZ2VudCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gcHJvY2Vzcy52ZXJzaW9uLnNsaWNlKDEpLnNwbGl0KCcuJykuc2xpY2UoMCwgMyk7XHJcbiAgICAgICAgICAgIHZhciB2ZXJzaW9uVGFpbHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh2ZXJzaW9uLCAxKS5qb2luKCcnKSB8fCAnMCc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogJ25vZGUnLFxyXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogdmVyc2lvbi5qb2luKCcuJyksXHJcbiAgICAgICAgICAgICAgICB2ZXJzaW9uTnVtYmVyOiBwYXJzZUZsb2F0KHZlcnNpb25bMF0gKyAnLicgKyB2ZXJzaW9uVGFpbHMpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyAnUGxlYXNlIGdpdmUgdXNlci1hZ2VudC5cXG4nICtcclxuICAgICAgICAgICAgICAgICAgJz4gYnJvd3NlcihuYXZpZ2F0b3IudXNlckFnZW50IG9yIHJlcy5oZWFkZXJzW1xcJ3VzZXItYWdlbnRcXCddKS4nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAqIFJlZmVyZW5jZWQgRGFtb25PZWhsbWFuL2RldGVjdC1icm93c2VyXHJcbiAgICB2YXIgYnJvd3NlcnMgPSBbXHJcbiAgICAgICAgWydlZGdlJywgL0VkZ2VcXC8oWzAtOVxcLl9dKykvXSxcclxuICAgICAgICBbJ3lhbmRleGJyb3dzZXInLCAvWWFCcm93c2VyXFwvKFswLTlcXC5fXSspL10sXHJcbiAgICAgICAgWydjaHJvbWUnLCAvKD8hQ2hyb20uKk9QUilDaHJvbSg/OmV8aXVtKVxcLyhbMC05XFwuXSspKDo/XFxzfCQpL10sXHJcbiAgICAgICAgWydjcmlvcycsIC9DcmlPU1xcLyhbMC05XFwuXSspKDo/XFxzfCQpL10sXHJcbiAgICAgICAgWydmaXJlZm94JywgL0ZpcmVmb3hcXC8oWzAtOVxcLl0rKSg/Olxcc3wkKS9dLFxyXG4gICAgICAgIFsnb3BlcmEnLCAvT3BlcmFcXC8oWzAtOVxcLl0rKSg/Olxcc3wkKS9dLFxyXG4gICAgICAgIFsnb3BlcmEnLCAvT1BSXFwvKFswLTlcXC5dKykoOj9cXHN8JCkkL10sXHJcbiAgICAgICAgWydpZScsIC9UcmlkZW50XFwvN1xcLjAuKnJ2XFw6KFswLTlcXC5dKylcXCkuKkdlY2tvJC9dLFxyXG4gICAgICAgIFsnaWUnLCAvTVNJRVxccyhbMC05XFwuXSspOy4qVHJpZGVudFxcL1s0LTddLjAvXSxcclxuICAgICAgICBbJ2llJywgL01TSUVcXHMoN1xcLjApL10sXHJcbiAgICAgICAgWydiYjEwJywgL0JCMTA7XFxzVG91Y2guKlZlcnNpb25cXC8oWzAtOVxcLl0rKS9dLFxyXG4gICAgICAgIFsnYW5kcm9pZCcsIC9BbmRyb2lkXFxzKFswLTlcXC5dKykvXSxcclxuICAgICAgICBbJ2lvcycsIC9WZXJzaW9uXFwvKFswLTlcXC5fXSspLipNb2JpbGUuKlNhZmFyaS4qL10sXHJcbiAgICAgICAgWydzYWZhcmknLCAvVmVyc2lvblxcLyhbMC05XFwuX10rKS4qU2FmYXJpL11cclxuICAgIF07XHJcblxyXG4gICAgcmV0dXJuIGJyb3dzZXJzXHJcbiAgICAgICAgLmZpbHRlcihlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbMV0udGVzdCh1c2VyQWdlbnQpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLm1hcChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgdmFyIG1hdGNoID0gZWxlbWVudFsxXS5leGVjKHVzZXJBZ2VudCk7XHJcbiAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gbWF0Y2ggJiYgbWF0Y2hbMV0uc3BsaXQoL1suX10vKS5zbGljZSgwLCAzKTtcclxuICAgICAgICAgICAgdmFyIHZlcnNpb25UYWlscyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHZlcnNpb24sIDEpLmpvaW4oJycpIHx8ICcwJztcclxuXHJcbiAgICAgICAgICAgIGlmICh2ZXJzaW9uICYmIHZlcnNpb24ubGVuZ3RoIDwgMykge1xyXG4gICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkodmVyc2lvbiwgKHZlcnNpb24ubGVuZ3RoID09PSAxKSA/IFswLCAwXSA6IFswXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBlbGVtZW50WzBdLFxyXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogdmVyc2lvbi5qb2luKCcuJyksXHJcbiAgICAgICAgICAgICAgICB2ZXJzaW9uTnVtYmVyOiBwYXJzZUZsb2F0KHZlcnNpb25bMF0gKyAnLicgKyB2ZXJzaW9uVGFpbHMpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSkuc2hpZnQoKTtcclxufTtcclxuXHJcbmRlZmluZSgnYnJvd3Nlci1kZXRlY3QnLFsncG9seWZpbGxzJ10sICgpID0+IHtcclxuICAgIHJldHVybiBicm93c2VyRGV0ZWN0b3I7XHJcbn0pO1xyXG5cbiIsImRlZmluZSgnbWFpbicsWydicm93c2VyLWRldGVjdCddLCAoYnJvd3NlckRldGVjdCkgPT4ge1xyXG4gICAgcmV0dXJuIChfdXNlckFnZW50KSA9PiB7XHJcbiAgICAgICAgdmFyIHVzZXJBZ2VudDtcclxuICAgICAgICBpZiAodHlwZW9mIF91c2VyQWdlbnQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCc/IHdpbmRvdy5uYXZpZ2F0b3IgOiBuYXZpZ2F0b3IpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIHVzZXJBZ2VudCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHVzZXJBZ2VudCA9IF91c2VyQWdlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBicm93c2VyRGV0ZWN0KHVzZXJBZ2VudCk7XHJcbiAgICB9O1xyXG59KTtcbiIsImlmIChBcnJheS5wcm90b3R5cGUubWFwID09PSB1bmRlZmluZWQpIHtcclxuICBBcnJheS5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24oZm4pIHtcclxuICAgIHZhciBydiA9IFtdO1xyXG4gICAgXHJcbiAgICBmb3IodmFyIGk9MCwgbD10aGlzLmxlbmd0aDsgaTxsOyBpKyspXHJcbiAgICAgIHJ2LnB1c2goZm4odGhpc1tpXSkpO1xyXG5cclxuICAgIHJldHVybiBydjtcclxuICB9O1xyXG59XHJcblxyXG5pZiAoQXJyYXkucHJvdG90eXBlLmZpbHRlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgQXJyYXkucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKGZuKSB7XHJcbiAgICB2YXIgcnYgPSBbXTtcclxuICAgIFxyXG4gICAgZm9yKHZhciBpPTAsIGw9dGhpcy5sZW5ndGg7IGk8bDsgaSsrKVxyXG4gICAgICBpZiAoZm4odGhpc1tpXSkpIHJ2LnB1c2godGhpc1tpXSk7XHJcblxyXG4gICAgcmV0dXJuIHJ2O1xyXG4gIH07XHJcbn1cclxuO1xuZGVmaW5lKFwicG9seWZpbGxzXCIsIGZ1bmN0aW9uKCl7fSk7XG5cbiJdfQ==
